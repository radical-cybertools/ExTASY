<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>2. Running a Coco/Amber Workload &mdash; ExTASY 0.1-beta documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1-beta',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="ExTASY 0.1-beta documentation" href="../index.html" />
    <link rel="next" title="3. Runing a Gromacs/LSDMap Workload" href="grlsd.html" />
    <link rel="prev" title="1. Installation" href="installation.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="grlsd.html" title="3. Runing a Gromacs/LSDMap Workload"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="1. Installation"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">ExTASY 0.1-beta documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="running-a-coco-amber-workload">
<span id="coam"></span><h1>2. Running a Coco/Amber Workload<a class="headerlink" href="#running-a-coco-amber-workload" title="Permalink to this headline">¶</a></h1>
<p>This section will discuss details about the execution phase. The input to the tool
is given in terms of a resource configuration file and a workload configuration file.
The execution is started based on the parameters set in these configuration files.</p>
<div class="section" id="running-on-stampede">
<h2>2.1. Running on Stampede<a class="headerlink" href="#running-on-stampede" title="Permalink to this headline">¶</a></h2>
<div class="section" id="running-the-example-workload">
<h3>2.1.1. Running the Example Workload<a class="headerlink" href="#running-the-example-workload" title="Permalink to this headline">¶</a></h3>
<p>This section is to be done entirely on your <strong>laptop</strong>. The ExTASY tool expects two input
files:</p>
<blockquote>
<div><ol class="arabic simple">
<li>The resource configuration file sets the parameters of the HPC resource we want
to run the workload on, in this case Stampede.</li>
<li>The workload configuration file defines the CoCo/Amber workload itself.</li>
</ol>
</div></blockquote>
<p><strong>Step 1</strong> : Create a new directory for the example,</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>mkdir $HOME/coam-on-stampede/
cd $HOME/coam-on-stampede/
</pre></div>
</div>
</div></blockquote>
<p><strong>Step 2</strong> : Create a new resource configuration file <tt class="docutils literal"><span class="pre">stampede.rcfg</span></tt> :</p>
<blockquote>
<div><p>(Download it <a class="reference external" href="https://raw.githubusercontent.com/radical-cybertools/ExTASY/master/config_files/coam-on-stampede/stampede.rcfg">stampede.rcfg</a> directly.)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Change the following values according to your needs :</p>
<ul class="last simple">
<li>UNAME</li>
<li>ALLOCATION</li>
</ul>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">REMOTE_HOST</span> <span class="o">=</span> <span class="s">&#39;stampede.tacc.utexas.edu&#39;</span>  <span class="c"># Label/Name of the Remote Machine</span>
<span class="n">UNAME</span>       <span class="o">=</span> <span class="s">&#39;username&#39;</span>                  <span class="c"># Username on the Remote Machine</span>
<span class="n">ALLOCATION</span>  <span class="o">=</span> <span class="s">&#39;TG-MCB090174&#39;</span>              <span class="c"># Allocation to be charged</span>
<span class="n">WALLTIME</span>    <span class="o">=</span> <span class="mi">60</span>                          <span class="c"># Walltime to be requested for the pilot</span>
<span class="n">PILOTSIZE</span>   <span class="o">=</span> <span class="mi">16</span>                          <span class="c"># Number of cores to be reserved</span>
<span class="n">WORKDIR</span>     <span class="o">=</span> <span class="bp">None</span>                        <span class="c"># Working directory on the remote machine</span>
<span class="n">QUEUE</span>       <span class="o">=</span> <span class="s">&#39;normal&#39;</span>                    <span class="c"># Name of the queue in the remote machine</span>

<span class="n">DBURL</span>       <span class="o">=</span> <span class="s">&#39;mongodb://extasy:extasyproject@extasy-db.epcc.ed.ac.uk/radicalpilot&#39;</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>Step 3</strong> : Download the sample input data:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>curl -k -O  https://raw.githubusercontent.com/radical-cybertools/ExTASY/master/input_files/coam-on-stampede/mdshort.in
curl -k -O  https://raw.githubusercontent.com/radical-cybertools/ExTASY/master/input_files/coam-on-stampede/min.in
curl -k -O  https://raw.githubusercontent.com/radical-cybertools/ExTASY/master/input_files/coam-on-stampede/penta.crd
curl -k -O  https://raw.githubusercontent.com/radical-cybertools/ExTASY/master/input_files/coam-on-stampede/penta.top
</pre></div>
</div>
</div></blockquote>
<p><strong>Step 4</strong> : Create a new workload configuration file <tt class="docutils literal"><span class="pre">cocoamber.wcfg</span></tt> :</p>
<blockquote>
<div><p>(Download it <a class="reference external" href="https://raw.githubusercontent.com/radical-cybertools/ExTASY/master/config_files/coam-on-stampede/cocoamber.wcfg">cocoamber.wcfg</a> directly.)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#-------------------------Applications----------------------</span>
<span class="n">simulator</span>                <span class="o">=</span> <span class="s">&#39;Amber&#39;</span>          <span class="c"># Simulator to be loaded</span>
<span class="n">analyzer</span>                 <span class="o">=</span> <span class="s">&#39;CoCo&#39;</span>           <span class="c"># Analyzer to be loaded</span>

<span class="c">#-------------------------General---------------------------</span>
<span class="n">num_iterations</span>          <span class="o">=</span> <span class="mi">4</span>                 <span class="c"># Number of iterations of Simulation-Analysis</span>
<span class="n">start_iter</span>              <span class="o">=</span> <span class="mi">0</span>                 <span class="c"># Iteration number with which to start</span>
<span class="n">num_CUs</span>         <span class="o">=</span> <span class="mi">16</span>                <span class="c"># Number of tasks or Compute Units</span>
<span class="n">nsave</span>           <span class="o">=</span> <span class="mi">2</span>         <span class="c"># Iterations after which output is transfered to local machine</span>

<span class="c">#-------------------------Simulation-----------------------</span>
<span class="n">num_cores_per_sim_cu</span>    <span class="o">=</span> <span class="mi">2</span>                 <span class="c"># Number of cores per Simulation Compute Units</span>
<span class="n">md_input_file</span>           <span class="o">=</span> <span class="s">&#39;./mdshort.in&#39;</span>    <span class="c"># Entire path to MD Input file - Do not use $HOME or the likes</span>
<span class="n">minimization_input_file</span> <span class="o">=</span> <span class="s">&#39;./min.in&#39;</span>        <span class="c"># Entire path to Minimization file - Do not use $HOME or the likes</span>
<span class="n">initial_crd_file</span>        <span class="o">=</span> <span class="s">&#39;./penta.crd&#39;</span>     <span class="c"># Entire path to Coordinates file - Do not use $HOME or the likes</span>
<span class="n">top_file</span>                <span class="o">=</span> <span class="s">&#39;./penta.top&#39;</span>     <span class="c"># Entire path to Topology file - Do not use $HOME or the likes</span>
<span class="n">logfile</span>                 <span class="o">=</span> <span class="s">&#39;coco.log&#39;</span>        <span class="c"># Name of the log file created by pyCoCo</span>

<span class="c">#-------------------------Analysis--------------------------</span>
<span class="n">grid</span>                    <span class="o">=</span> <span class="s">&#39;5&#39;</span>               <span class="c"># Number of points along each dimension of the CoCo histogram</span>
<span class="n">dims</span>                    <span class="o">=</span> <span class="s">&#39;3&#39;</span>               <span class="c"># The number of projections to consider from the input pcz file</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>Now you are can run the workload using :</strong></p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>RADICAL_PILOT_VERBOSE=&#39;debug&#39; SAGA_VERBOSE=&#39;debug&#39; extasy --RPconfig stampede.rcfg --Kconfig cocoamber.wcfg 2&gt; extasy.log
</pre></div>
</div>
</div></blockquote>
<p>A <strong>sample output</strong> with expected callbacks and simulation/analysis can be found at <a class="reference external" href="https://github.com/radical-cybertools/ExTASY/tree/master/sample_output_logs/coam-on-stampede">here</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="30%" />
<col width="26%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Stage</th>
<th class="head">Simulation</th>
<th class="head">Analysis</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Expected TTC/iteration</td>
<td>30-35 s</td>
<td>25-30 s</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="running-on-archer">
<h2>2.2. Running on Archer<a class="headerlink" href="#running-on-archer" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>2.2.1. Running the Example Workload<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>This section is to be done entirely on your <strong>laptop</strong>. The ExTASY tool expects two input
files:</p>
<blockquote>
<div><ol class="arabic simple">
<li>The resource configuration file sets the parameters of the HPC resource we want
to run the workload on, in this case Archer.</li>
<li>The workload configuration file defines the CoCo/Amber workload itself.</li>
</ol>
</div></blockquote>
<p><strong>Step 1</strong> : Create a new directory for the example,</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>mkdir $HOME/coam-on-archer/
cd $HOME/coam-on-archer/
</pre></div>
</div>
</div></blockquote>
<p><strong>Step 2</strong> : Create a new resource configuration file <tt class="docutils literal"><span class="pre">archer.rcfg</span></tt> :</p>
<blockquote>
<div><p>(Download it <a class="reference external" href="https://raw.githubusercontent.com/radical-cybertools/ExTASY/master/config_files/coam-on-archer/archer.rcfg">archer.rcfg</a> directly.)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Change the following values according to your needs :</p>
<ul class="last simple">
<li>UNAME</li>
<li>ALLOCATION</li>
</ul>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">REMOTE_HOST</span> <span class="o">=</span> <span class="s">&#39;archer.ac.uk&#39;</span>              <span class="c"># Label/Name of the Remote Machine</span>
<span class="n">UNAME</span>       <span class="o">=</span> <span class="s">&#39;username&#39;</span>                  <span class="c"># Username on the Remote Machine</span>
<span class="n">ALLOCATION</span>  <span class="o">=</span> <span class="s">&#39;e290&#39;</span>                      <span class="c"># Allocation to be charged</span>
<span class="n">WALLTIME</span>    <span class="o">=</span> <span class="mi">60</span>                          <span class="c"># Walltime to be requested for the pilot</span>
<span class="n">PILOTSIZE</span>   <span class="o">=</span> <span class="mi">24</span>                          <span class="c"># Number of cores to be reserved</span>
<span class="n">WORKDIR</span>     <span class="o">=</span> <span class="bp">None</span>                        <span class="c"># Working directory on the remote machine</span>
<span class="n">QUEUE</span>       <span class="o">=</span> <span class="s">&#39;standard&#39;</span>                  <span class="c"># Name of the queue in the remote machine</span>

<span class="n">DBURL</span>       <span class="o">=</span> <span class="s">&#39;mongodb://extasy:extasyproject@extasy-db.epcc.ed.ac.uk/radicalpilot&#39;</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>Step 3</strong> : Download the sample input data:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>curl -k -O  https://raw.githubusercontent.com/radical-cybertools/ExTASY/master/input_files/coam-on-archer/mdshort.in
curl -k -O  https://raw.githubusercontent.com/radical-cybertools/ExTASY/master/input_files/coam-on-archer/min.in
curl -k -O  https://raw.githubusercontent.com/radical-cybertools/ExTASY/master/input_files/coam-on-archer/penta.crd
curl -k -O  https://raw.githubusercontent.com/radical-cybertools/ExTASY/master/input_files/coam-on-archer/penta.top
</pre></div>
</div>
</div></blockquote>
<p><strong>Step 4</strong> : Create a new workload configuration file <tt class="docutils literal"><span class="pre">cocoamber.wcfg</span></tt> :</p>
<blockquote>
<div><p>(Download it <a class="reference external" href="https://raw.githubusercontent.com/radical-cybertools/ExTASY/master/config_files/coam-on-archer/cocoamber.wcfg">cocoamber.wcfg</a> directly.)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#-------------------------Applications----------------------</span>
<span class="n">simulator</span>                <span class="o">=</span> <span class="s">&#39;Amber&#39;</span>          <span class="c"># Simulator to be loaded</span>
<span class="n">analyzer</span>                 <span class="o">=</span> <span class="s">&#39;CoCo&#39;</span>           <span class="c"># Analyzer to be loaded</span>

<span class="c">#-------------------------General---------------------------</span>
<span class="n">num_iterations</span>          <span class="o">=</span> <span class="mi">2</span>                 <span class="c"># Number of iterations of Simulation-Analysis</span>
<span class="n">start_iter</span>              <span class="o">=</span> <span class="mi">0</span>                 <span class="c"># Iteration number with which to start</span>
<span class="n">num_CUs</span>                 <span class="o">=</span> <span class="mi">8</span>                <span class="c"># Number of tasks or Compute Units</span>
<span class="n">nsave</span>                   <span class="o">=</span> <span class="mi">1</span>                 <span class="c"># Iterations after which output is transfered to local machine</span>

<span class="c">#-------------------------Simulation-----------------------</span>
<span class="n">num_cores_per_sim_cu</span>    <span class="o">=</span> <span class="mi">2</span>                 <span class="c"># Number of cores per Simulation Compute Units</span>
<span class="n">md_input_file</span>           <span class="o">=</span> <span class="s">&#39;./mdshort.in&#39;</span>    <span class="c"># Entire path to MD Input file - Do not use $HOME or the likes</span>
<span class="n">minimization_input_file</span> <span class="o">=</span> <span class="s">&#39;./min.in&#39;</span>        <span class="c"># Entire path to Minimization file - Do not use $HOME or the likes</span>
<span class="n">initial_crd_file</span>        <span class="o">=</span> <span class="s">&#39;./penta.crd&#39;</span>     <span class="c"># Entire path to Coordinates file - Do not use $HOME or the likes</span>
<span class="n">top_file</span>                <span class="o">=</span> <span class="s">&#39;./penta.top&#39;</span>     <span class="c"># Entire path to Topology file - Do not use $HOME or the likes</span>
<span class="n">logfile</span>                 <span class="o">=</span> <span class="s">&#39;coco.log&#39;</span>        <span class="c"># Name of the log file created by pyCoCo</span>

<span class="c">#-------------------------Analysis--------------------------</span>
<span class="n">grid</span>                    <span class="o">=</span> <span class="s">&#39;5&#39;</span>               <span class="c"># Number of points along each dimension of the CoCo histogram</span>
<span class="n">dims</span>                    <span class="o">=</span> <span class="s">&#39;3&#39;</span>               <span class="c"># The number of projections to consider from the input pcz file</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>Now you are can run the workload using :</strong></p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>RADICAL_PILOT_VERBOSE=&#39;debug&#39; SAGA_VERBOSE=&#39;debug&#39; extasy --RPconfig archer.rcfg --Kconfig cocoamber.wcfg 2&gt; extasy.log
</pre></div>
</div>
</div></blockquote>
<p>A <strong>sample output</strong> with expected callbacks and simulation/analysis can be found at <a class="reference external" href="https://github.com/radical-cybertools/ExTASY/tree/master/sample_output_logs/coam-on-archer">here</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="30%" />
<col width="26%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Stage</th>
<th class="head">Simulation</th>
<th class="head">Analysis</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Expected TTC/iteration</td>
<td>60-100 s</td>
<td>150-200 s</td>
</tr>
</tbody>
</table>
<p>There are two stages in the execution phase - Simulation and Analysis. Execution
starts with any Preprocessing that might be required on the input data and then
moves to Simulation stage. In the Simulation stage, a number of tasks (num_CUs)
are launched to execute on the target machine. The number of tasks set to execute
depends on the PILOTSIZE, num_CUs, num_cores_per_sim_cu, the number of tasks in
execution state simultaneously would be PILOTSIZE/num_cores_per_sim_cu. As each
task attains &#8216;Done&#8217; (completed) state, the remain tasks are scheduled till all
the num_CUs tasks are completed.</p>
<p>This is followed by the Analysis stage, one task is scheduled on the target machine
which takes all the cores as the PILOTSIZE to perform the analysis and returns the
data required for the next iteration of the Simulation stage. As can be seen, per
iteration, there are (num_CUs+1) tasks executed.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">2. Running a Coco/Amber Workload</a><ul>
<li><a class="reference internal" href="#running-on-stampede">2.1. Running on Stampede</a><ul>
<li><a class="reference internal" href="#running-the-example-workload">2.1.1. Running the Example Workload</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-on-archer">2.2. Running on Archer</a><ul>
<li><a class="reference internal" href="#id1">2.2.1. Running the Example Workload</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="installation.html"
                        title="previous chapter">1. Installation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="grlsd.html"
                        title="next chapter">3. Runing a Gromacs/LSDMap Workload</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/pages/coam.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="grlsd.html" title="3. Runing a Gromacs/LSDMap Workload"
             >next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="1. Installation"
             >previous</a> |</li>
        <li><a href="../index.html">ExTASY 0.1-beta documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, RADICAL Group at Rutgers.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>